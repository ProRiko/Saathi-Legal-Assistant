<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="Saathi Legal Assistant - Your AI-powered legal companion for consultation, document generation, and legal guidance">
    <meta name="keywords" content="legal assistant, AI lawyer, legal consultation, document generation, Indian law">
    <meta name="theme-color" content="#1a2332">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Saathi Legal">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="enhanced-ux.css">
    <title>Saathi Legal Assistant - Your AI Legal Companion</title>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">🏛️</div>
            <div id="languageIndicator" style="position: absolute; top: 20px; right: 20px; background: rgba(139, 69, 19, 0.2); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 20px; padding: 8px 15px; color: #f4f1e8; font-size: 0.9em; cursor: pointer;" onclick="window.location.href='/language-selection.html'">
                🌍 <span id="currentLanguage">English</span>
            </div>
            <h1>Saathi Legal Assistant</h1>
            <p>Your AI-powered legal companion for consultation, document generation, and legal guidance</p>
        </div>

        <div class="main-content">
            <!-- User Details Section -->
            <div class="name-section">
                <h2>Welcome! Let's get started</h2>
                <p>Please enter your details for a personalized consultation experience:</p>
                <div class="name-input-group">
                    <input type="text" id="userName" class="name-input" placeholder="Enter your full name" maxlength="50" style="margin-bottom: 10px;">
                    <input type="tel" id="userPhone" class="name-input" placeholder="Enter your phone number (10 digits)" maxlength="10" pattern="[0-9]{10}">
                    <button onclick="saveDetails()" class="save-name-btn">Save Details</button>
                </div>
                <div id="welcomeMessage" class="welcome-message" style="display: none;"></div>
            </div>

            <!-- Legal Disclaimer -->
            <div class="disclaimer">
                <div class="disclaimer-icon">⚖️</div>
                <h3>IMPORTANT LEGAL DISCLAIMER</h3>
                <p><strong>Please read carefully before proceeding:</strong></p>
                <p>• This AI assistant provides <strong>general legal information only</strong> and does not constitute legal advice</p>
                <p>• <strong>Always consult a qualified attorney</strong> for specific legal matters and before making legal decisions</p>
                <p>• Generated documents are <strong>templates for reference only</strong> and may require customization</p>
                <p>• We are <strong>not responsible</strong> for the accuracy, completeness, or legal validity of AI-generated content</p>
                <p>• <strong>Your conversations may be logged</strong> to improve our services</p>
                <p><strong>By proceeding, you acknowledge and accept these terms.</strong></p>
            </div>

            <!-- Features Section -->
            <div class="features">
                <div class="feature-card">
                    <div class="feature-icon">💬</div>
                    <h3>AI Legal Consultation</h3>
                    <p>Get instant answers to your legal questions with our advanced AI assistant trained on Indian law</p>
                </div>

                <div class="feature-card" onclick="window.location.href='/templates.html'" style="cursor: pointer;">
                    <div class="feature-icon">📄</div>
                    <h3>Smart Templates</h3>
                    <p>Create professional legal documents instantly with our smart templates - rent agreements, legal notices, contracts</p>
                </div>

                <div class="feature-card" onclick="openCalculatorModal()" style="cursor: pointer;">
                    <div class="feature-icon">🧮</div>
                    <h3>Rights Calculator</h3>
                    <p>Calculate your legal entitlements - gratuity, PF, notice pay, stamp duty, refunds, and more</p>
                </div>

                <div class="feature-card" onclick="window.location.href='/legal-help.html'" style="cursor: pointer;">
                    <div class="feature-icon">🏛️</div>
                    <h3>Find Legal Help</h3>
                    <p>Connect with qualified lawyers, legal aid centers, courts, and NGOs in your area</p>
                </div>

                <div class="feature-card" onclick="window.location.href='/case-tracker.html'" style="cursor: pointer;">
                    <div class="feature-icon">📋</div>
                    <h3>Legal Case Tracker</h3>
                    <p>Track your legal cases, court dates, deadlines, and case progress all in one place</p>
                </div>

                <div class="feature-card" onclick="window.location.href='/language-selection.html'" style="cursor: pointer;">
                    <div class="feature-icon">🌍</div>
                    <h3>Multi-Language Support</h3>
                    <p>Get legal assistance in Hindi, Marathi, Tamil, Telugu, Gujarati, Bengali, Kannada, Punjabi, and English</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">📋</div>
                    <h3>Legal Forms</h3>
                    <p>Access and customize legal forms for rental agreements, employment contracts, and more</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🔒</div>
                    <h3>Secure & Private</h3>
                    <p>Your consultations are secure with rate limiting and privacy protection measures</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions" style="text-align: center; margin: 40px 0;">
                <h3 style="color: #f4f1e8; margin-bottom: 20px;">🚀 Quick Actions</h3>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <a href="/templates.html" class="quick-action-btn">
                        📄 Create Documents
                    </a>
                    <a href="#" onclick="openCalculatorModal()" class="quick-action-btn">
                        🧮 Calculate Rights
                    </a>
                    <a href="/legal-help.html" class="quick-action-btn">
                        🏛️ Find Legal Help
                    </a>
                    <a href="/case-tracker.html" class="quick-action-btn">
                        📋 Track Cases
                    </a>
                    <a href="/language-selection.html" class="quick-action-btn">
                        🌍 Choose Language
                    </a>
                    <a href="#" onclick="startConsultation()" class="quick-action-btn" id="chatBtn">
                        💬 Ask Legal Questions
                    </a>
                </div>
            </div>

            <!-- CTA Section -->
            <div class="cta-section">
                <button id="startBtn" class="start-consulting-btn" onclick="startConsultation()" disabled>
                    🚀 Start Consultation
                </button>
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Preparing your consultation session...</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>&copy; 2025 Saathi Legal Assistant. Built with ❤️ for the legal community.</p>
            <p>Made in India 🇮🇳 | Powered by AI</p>
        </div>
    </div>

    <script>
        let userName = '';
        let userPhone = '';
        
        // Enable start button only after details are saved
        function saveDetails() {
            const nameInput = document.getElementById('userName');
            const phoneInput = document.getElementById('userPhone');
            const name = nameInput.value.trim();
            const phone = phoneInput.value.trim();
            
            // Clear any existing error messages
            clearErrorMessages();
            
            if (!name) {
                showError('Please enter your name to continue', nameInput);
                return;
            }
            
            if (name.length < 2) {
                showError('Please enter a valid name (at least 2 characters)', nameInput);
                return;
            }
            
            if (!/^[a-zA-Z\s\.]+$/.test(name)) {
                showError('Name should contain only letters, spaces, and dots', nameInput);
                return;
            }
            
            if (!phone) {
                showError('Please enter your phone number to continue', phoneInput);
                return;
            }
            
            if (!/^[6-9][0-9]{9}$/.test(phone)) {
                showError('Please enter a valid Indian mobile number (10 digits starting with 6-9)', phoneInput);
                return;
            }
            
            userName = name;
            userPhone = phone;
            
            // Save to localStorage for persistence
            localStorage.setItem('saathi_user_name', userName);
            localStorage.setItem('saathi_user_phone', userPhone);
            
            // Show success message
            showSuccess(`✅ Welcome, ${userName}! Your details have been saved. You can now start your consultation.`);
            
            // Enable start button with smooth transition
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
            startBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            startBtn.style.transform = 'scale(1.02)';
            setTimeout(() => {
                startBtn.style.transform = 'scale(1)';
            }, 200);
            
            // Disable inputs with visual feedback
            nameInput.disabled = true;
            phoneInput.disabled = true;
            nameInput.style.background = 'rgba(139, 69, 19, 0.1)';
            phoneInput.style.background = 'rgba(139, 69, 19, 0.1)';
            
            const saveBtn = document.querySelector('.save-name-btn');
            saveBtn.disabled = true;
            saveBtn.style.background = '#28a745';
            saveBtn.innerHTML = '✓ Details Saved';
        }

        // Error handling functions
        function showError(message, inputElement = null) {
            const errorDiv = document.getElementById('errorMessage') || createErrorDiv();
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            errorDiv.className = 'error-message show';
            
            if (inputElement) {
                inputElement.style.borderColor = '#dc3545';
                inputElement.focus();
                inputElement.addEventListener('input', clearFieldError, { once: true });
            }
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
                errorDiv.className = 'error-message';
            }, 4000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage') || createSuccessDiv();
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            successDiv.className = 'success-message show';
            
            setTimeout(() => {
                successDiv.style.display = 'none';
                successDiv.className = 'success-message';
            }, 3000);
        }

        function clearErrorMessages() {
            const errorDiv = document.getElementById('errorMessage');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
            
            // Reset input field styles
            document.getElementById('userName').style.borderColor = '';
            document.getElementById('userPhone').style.borderColor = '';
        }

        function clearFieldError(event) {
            event.target.style.borderColor = '';
        }

        function createErrorDiv() {
            const div = document.createElement('div');
            div.id = 'errorMessage';
            div.className = 'error-message';
            div.style.cssText = `
                background: #f8d7da; color: #721c24; border: 1px solid #f1aeb5;
                padding: 12px 20px; border-radius: 8px; margin: 15px 0;
                display: none; opacity: 0; transition: opacity 0.3s ease;
            `;
            document.querySelector('.name-section').appendChild(div);
            return div;
        }

        function createSuccessDiv() {
            const div = document.createElement('div');
            div.id = 'successMessage';
            div.className = 'success-message';
            div.style.cssText = `
                background: #d1e7dd; color: #0f5132; border: 1px solid #a3cfbb;
                padding: 12px 20px; border-radius: 8px; margin: 15px 0;
                display: none; opacity: 0; transition: opacity 0.3s ease;
            `;
            document.querySelector('.name-section').appendChild(div);
            return div;
        }
        
        // Check if details already saved
        function checkSavedDetails() {
            const savedName = localStorage.getItem('saathi_user_name');
            const savedPhone = localStorage.getItem('saathi_user_phone');
            if (savedName && savedPhone) {
                document.getElementById('userName').value = savedName;
                document.getElementById('userPhone').value = savedPhone;
                saveDetails();
            }
        }
        
        // Start consultation
        function startConsultation() {
            if (!userName || !userPhone) {
                alert('Please save your details first');
                return;
            }
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('startBtn').style.display = 'none';
            
            // Send user details to server for session tracking
            fetch('/api/start-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_name: userName,
                    user_phone: userPhone,
                    timestamp: new Date().toISOString(),
                    session_id: generateSessionId()
                })
            }).then(response => {
                // Redirect to chat regardless of server response
                setTimeout(() => {
                    window.location.href = 'chat.html';
                }, 2000);
            }).catch(error => {
                // Still redirect even if session logging fails
                console.log('Session logging failed, but continuing...');
                setTimeout(() => {
                    window.location.href = 'chat.html';
                }, 2000);
            });
        }
        
        // Generate unique session ID
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Allow Enter key to save details
        document.getElementById('userName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('userPhone').focus();
            }
        });
        
        document.getElementById('userPhone').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                saveDetails();
            }
        });
        
        // Initialize
        checkSavedDetails();
        
        // Auto-focus on name input
        document.getElementById('userName').focus();
        
        // Calculator Modal Functions
        function openCalculatorModal() {
            document.getElementById('calculatorModal').style.display = 'block';
        }
        
        function closeCalculatorModal() {
            document.getElementById('calculatorModal').style.display = 'none';
        }
        
        function calculateGratuity() {
            const salary = parseFloat(document.getElementById('salary').value);
            const years = parseInt(document.getElementById('years').value);
            const months = parseInt(document.getElementById('months').value) || 0;
            
            if (!salary || !years) {
                alert('Please enter salary and years of service');
                return;
            }
            
            if (years < 5) {
                showResult('gratuityResult', 'Not Eligible', 'Gratuity requires minimum 5 years of continuous service');
                return;
            }
            
            const totalYears = years + (months >= 6 ? 1 : 0);
            const gratuity = Math.min((salary * 15 * totalYears) / 26, 2000000);
            const formula = `(₹${salary.toLocaleString()} × 15 × ${totalYears}) ÷ 26`;
            
            showResult('gratuityResult', `₹${gratuity.toLocaleString('en-IN')}`, 
                `Formula: ${formula}<br>Years considered: ${totalYears}<br>Maximum limit: ₹20,00,000`);
        }
        
        function calculatePF() {
            const basic = parseFloat(document.getElementById('basicSalary').value);
            const years = parseFloat(document.getElementById('pfYears').value);
            const rate = parseFloat(document.getElementById('interest').value) / 100;
            
            if (!basic || !years) {
                alert('Please enter basic salary and years of service');
                return;
            }
            
            const monthlyContribution = basic * 0.24;
            const annualContribution = monthlyContribution * 12;
            const balance = years > 0 ? annualContribution * (Math.pow(1 + rate, years) - 1) / rate : 0;
            
            showResult('pfResult', `₹${balance.toLocaleString('en-IN')}`, 
                `Monthly contribution: ₹${monthlyContribution.toLocaleString('en-IN')}<br>Annual contribution: ₹${annualContribution.toLocaleString('en-IN')}<br>Interest rate: ${(rate*100).toFixed(1)}%`);
        }
        
        function calculateStampDuty() {
            const value = parseFloat(document.getElementById('propertyValue').value);
            const rate = parseFloat(document.getElementById('state').value);
            
            if (!value) {
                alert('Please enter property value');
                return;
            }
            
            const stampDuty = value * rate;
            
            showResult('stampResult', `₹${stampDuty.toLocaleString('en-IN')}`, 
                `Property value: ₹${value.toLocaleString('en-IN')}<br>Stamp duty rate: ${(rate*100)}%<br>Calculation: ₹${value.toLocaleString('en-IN')} × ${(rate*100)}%`);
        }
        
        function showResult(elementId, amount, details) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div style="font-size: 1.8em; color: #8b4513; font-weight: bold; margin-bottom: 10px;">${amount}</div>
                <div style="color: #f4f1e8; line-height: 1.6;">${details}</div>
            `;
            element.style.display = 'block';
        }

        // Language functionality
        function loadLanguagePreference() {
            const savedLanguage = localStorage.getItem('preferredLanguage');
            const languageName = localStorage.getItem('languageName');
            
            if (savedLanguage && languageName) {
                document.getElementById('currentLanguage').textContent = languageName;
                
                // Add a small notification that language is active
                const indicator = document.getElementById('languageIndicator');
                indicator.style.background = 'rgba(40, 167, 69, 0.2)';
                indicator.style.borderColor = 'rgba(40, 167, 69, 0.3)';
                indicator.title = `Current language: ${languageName}. Click to change.`;
            } else {
                // Suggest selecting a language
                document.getElementById('languageIndicator').title = 'Click to select your preferred language';
            }
        }

        // Load language preference when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadLanguagePreference();
        });
    </script>

    <!-- Rights Calculator Modal -->
    <div id="calculatorModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);">
        <div style="background: linear-gradient(135deg, #1a2332 0%, #2a3441 100%); margin: 5% auto; padding: 30px; border: 2px solid #8b4513; border-radius: 15px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 style="color: #f4f1e8; margin: 0;">🧮 Legal Rights Calculator</h2>
                <button onclick="closeCalculatorModal()" style="background: none; border: none; color: #f4f1e8; font-size: 2em; cursor: pointer;">&times;</button>
            </div>
            
            <!-- Gratuity Calculator -->
            <div style="background: rgba(244, 241, 232, 0.1); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h3 style="color: #f4f1e8; margin-bottom: 20px;">💰 Gratuity Calculator</h3>
                <div style="display: grid; gap: 15px;">
                    <input type="number" id="salary" placeholder="Monthly Salary (₹)" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <input type="number" id="years" placeholder="Years of Service" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <input type="number" id="months" placeholder="Extra Months (0-11)" min="0" max="11" value="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <button onclick="calculateGratuity()" style="background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); color: #f4f1e8; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; cursor: pointer;">Calculate Gratuity</button>
                </div>
                <div id="gratuityResult" style="background: rgba(244, 241, 232, 0.1); border-radius: 10px; padding: 20px; margin: 20px 0; display: none;"></div>
            </div>

            <!-- PF Calculator -->
            <div style="background: rgba(244, 241, 232, 0.1); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h3 style="color: #f4f1e8; margin-bottom: 20px;">🏦 Provident Fund Calculator</h3>
                <div style="display: grid; gap: 15px;">
                    <input type="number" id="basicSalary" placeholder="Basic Salary (₹)" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <input type="number" id="pfYears" placeholder="Years of Service" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <input type="number" id="interest" placeholder="Interest Rate %" value="8.5" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <button onclick="calculatePF()" style="background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); color: #f4f1e8; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; cursor: pointer;">Calculate PF Balance</button>
                </div>
                <div id="pfResult" style="background: rgba(244, 241, 232, 0.1); border-radius: 10px; padding: 20px; margin: 20px 0; display: none;"></div>
            </div>

            <!-- Stamp Duty Calculator -->
            <div style="background: rgba(244, 241, 232, 0.1); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h3 style="color: #f4f1e8; margin-bottom: 20px;">🏠 Stamp Duty Calculator</h3>
                <div style="display: grid; gap: 15px;">
                    <input type="number" id="propertyValue" placeholder="Property Value (₹)" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <select id="state" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                        <option value="0.05">Maharashtra (5%)</option>
                        <option value="0.06">Delhi (6%)</option>
                        <option value="0.05">Karnataka (5%)</option>
                        <option value="0.04">Gujarat (4%)</option>
                        <option value="0.05">Other States (5%)</option>
                    </select>
                    <button onclick="calculateStampDuty()" style="background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); color: #f4f1e8; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; cursor: pointer;">Calculate Stamp Duty</button>
                </div>
                <div id="stampResult" style="background: rgba(244, 241, 232, 0.1); border-radius: 10px; padding: 20px; margin: 20px 0; display: none;"></div>
            </div>

            <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; padding: 15px; margin: 20px 0; color: #f4f1e8; text-align: center;">
                <strong>⚠️ Disclaimer:</strong> These are estimates based on general legal provisions. Consult a legal expert for accurate advice.
            </div>
        </div>
    </div>
    </script>
    <script src="enhanced-ux.js"></script>
</body>
</html>
