<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="Saathi Legal Assistant - Your AI-powered legal companion for consultation, document generation, and legal guidance">
    <meta name="keywords" content="legal assistant, AI lawyer, legal consultation, document generation, Indian law">
    <meta name="theme-color" content="#1a2332">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Saathi Legal">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="enhanced-ux.css">
    <link rel="stylesheet" href="device-compatibility.css">
    <script src="anon-id.js"></script>
    <title>Saathi Legal Assistant - Your AI Legal Companion</title>
    <style>
        .hero-cta-banner {
            margin: 30px auto 10px;
            padding: 24px;
            border-radius: 28px;
            background: linear-gradient(135deg, rgba(247, 219, 167, 0.15), rgba(118, 75, 162, 0.15));
            border: 1px solid rgba(247, 219, 167, 0.3);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
        }
        .hero-cta-banner h2 {
            margin: 0;
            font-size: 1.6rem;
            color: #f7dba7;
        }
        .hero-cta-banner p {
            margin: 6px 0 0;
            color: #dcd3c3;
        }
        .hero-cta-actions {
            margin-left: auto;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .hero-cta-actions a,
        .hero-cta-actions button {
            text-decoration: none;
            border: none;
            border-radius: 999px;
            padding: 12px 22px;
            font-weight: 600;
            cursor: pointer;
            color: #1a1309;
        }
        .hero-cta-actions .primary {
            background: linear-gradient(120deg, #f9a826, #f76b1c);
        }
        .hero-cta-actions .secondary {
            background: rgba(255, 255, 255, 0.08);
            color: #f4f1e8;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        @media (max-width: 720px) {
            .hero-cta-banner {
                flex-direction: column;
                align-items: flex-start;
            }
            .hero-cta-actions {
                width: 100%;
            }
            .hero-cta-actions a,
            .hero-cta-actions button {
                width: 100%;
                text-align: center;
            }
        }
        .info-banner {
            margin: 20px 0 30px;
            padding: 18px 22px;
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #f4f1e8;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }
        .info-banner strong {
            color: #f7dba7;
        }
        .info-banner a {
            color: #f7dba7;
            text-decoration: underline;
        }
        .footer a {
            color: #f7dba7;
            text-decoration: none;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <nav class="site-nav" aria-label="Primary navigation">
        <div class="site-nav__brand">
            <a href="/">Saathi Legal Assistant</a>
        </div>
        <div class="site-nav__links">
            <a href="/" class="is-active">Home</a>
            <a href="/tools.html">Tools</a>
            <a href="/legal-notices.html">Notices</a>
            <a href="/agreement-templates.html">Agreements</a>
            <a href="/legal-calculators.html">Calculators</a>
            <a href="/chat.html">Chat</a>
        </div>
    </nav>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üèõÔ∏è</div>
            <div id="languageIndicator" style="position: absolute; top: 20px; right: 20px; background: rgba(139, 69, 19, 0.2); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 20px; padding: 8px 15px; color: #f4f1e8; font-size: 0.9em; cursor: pointer;" onclick="window.location.href='/language-selection.html'">
                üåç <span id="currentLanguage">English</span>
            </div>
            <h1>Saathi Legal Assistant</h1>
            <p>Your AI-powered legal companion for consultation, document generation, and legal guidance</p>
        </div>

        <div class="hero-cta-banner">
            <div>
                <h2>Need answers fast?</h2>
                <p>Jump into chat, browse legal notices, or run compliance calculators in two clicks.</p>
            </div>
            <div class="hero-cta-actions">
                <button class="primary" type="button" onclick="startConsultation()">üí¨ Start Chat</button>
                <a class="secondary" href="/legal-notices.html">‚ö†Ô∏è Legal Notices</a>
                <a class="secondary" href="/legal-calculators.html">üßÆ Calculators</a>
            </div>
        </div>

                <!-- Main Content -->
        <div class="main-content">
            <!-- Device Compatibility Notice -->
            <div id="deviceNotice" class="device-notice" style="display: none;">
                <h3>üì± Device Access Help</h3>
                <p>Having trouble accessing Saathi? <a href="/device-test.html" target="_blank">Run our compatibility test</a> to diagnose the issue.</p>
                <div class="device-tips">
                    <strong>Quick fixes:</strong>
                    <ul>
                        <li>Try refreshing the page (Ctrl+F5)</li>
                        <li>Clear browser cache and cookies</li>
                        <li>Try a different browser (Chrome recommended)</li>
                        <li>Check your internet connection</li>
                    </ul>
                </div>
            </div>
            <!-- Legal Disclaimer -->
            <div class="disclaimer">
                <div class="disclaimer-icon">‚öñÔ∏è</div>
                <h3>IMPORTANT LEGAL DISCLAIMER</h3>
                <p><strong>Please read carefully before proceeding:</strong></p>
                <p>‚Ä¢ This AI assistant provides <strong>general legal information only</strong> and does not constitute legal advice</p>
                <p>‚Ä¢ <strong>Always consult a qualified attorney</strong> for specific legal matters and before making legal decisions</p>
                <p>‚Ä¢ Generated documents are <strong>templates for reference only</strong> and may require customization</p>
                <p>‚Ä¢ We are <strong>not responsible</strong> for the accuracy, completeness, or legal validity of AI-generated content</p>
                <p>‚Ä¢ <strong>Your conversations may be logged</strong> to improve our services</p>
                <p><strong>By proceeding, you acknowledge and accept these terms.</strong></p>
            </div>

            <div class="info-banner">
                <span>‚ÑπÔ∏è</span>
                <div>
                    <strong>Information only:</strong> Saathi shares general legal guidance, not attorney-client advice. Review our <a href="/privacy.html" target="_blank" rel="noopener">Privacy Policy</a> to learn how your inputs are handled.
                </div>
            </div>

            <!-- Features Section -->
            <div class="features">
                <div class="feature-card" onclick="startConsultation('chat')" style="cursor: pointer;">
                    <div class="feature-icon">üí¨</div>
                    <h3>AI Legal Consultation</h3>
                    <p>Get instant answers to your legal questions with our advanced AI assistant trained on Indian law</p>
                    <div class="feature-cta">Ask Legal Questions Now ‚Üí</div>
                </div>

                <div class="feature-card" onclick="startConsultation('documents')" style="cursor: pointer;">
                    <div class="feature-icon">üìÑ</div>
                    <h3>Smart Templates</h3>
                    <p>Create professional legal documents instantly with our smart templates - rent agreements, legal notices, contracts</p>
                    <div class="feature-cta">Generate Legal Documents ‚Üí</div>
                </div>

                <div class="feature-card" onclick="openCalculatorModal()" style="cursor: pointer;">
                    <div class="feature-icon">üßÆ</div>
                    <h3>Rights Calculator</h3>
                    <p>Calculate your legal entitlements - gratuity, PF, notice pay, stamp duty, refunds, and more</p>
                    <div class="feature-cta">Check Your Rights ‚Üí</div>
                </div>

                <div class="feature-card" onclick="window.location.href='legal-calculators.html'" style="cursor: pointer;">
                    <div class="feature-icon">üìä</div>
                    <h3>Compliance Calculators</h3>
                    <p>Get instant estimates for notice periods, working hours, maternity benefits, and consumer compensation</p>
                    <div class="feature-cta">Launch Calculators ‚Üí</div>
                </div>

                <div class="feature-card" onclick="window.location.href='legal_help.html'" style="cursor: pointer;">
                    <div class="feature-icon">üèõÔ∏è</div>
                    <h3>Find Legal Help</h3>
                    <p>Connect with qualified lawyers, legal aid centers, courts, and NGOs in your area</p>
                    <div class="feature-cta">Find Legal Experts ‚Üí</div>
                </div>

                <div class="feature-card" onclick="window.location.href='legal-notices.html'" style="cursor: pointer;">
                    <div class="feature-icon">‚ö†Ô∏è</div>
                    <h3>Legal Notice Generator</h3>
                    <p>Download advocate-style notices for salary delays, rent defaults, consumer issues, and cheque bounce cases</p>
                    <div class="feature-cta">Generate Notices ‚Üí</div>
                </div>

                <div class="feature-card" onclick="window.location.href='agreement-templates.html'" style="cursor: pointer;">
                    <div class="feature-icon">üìÑ</div>
                    <h3>Agreement Templates</h3>
                    <p>Access ready-to-sign rent agreements, freelance contracts, offer letters, NDAs, and sale of goods drafts</p>
                    <div class="feature-cta">Download Templates ‚Üí</div>
                </div>

                <div class="feature-card" onclick="openCaseTracker()" style="cursor: pointer;">
                    <div class="feature-icon">üìã</div>
                    <h3>Legal Case Tracker</h3>
                    <p>Track your legal cases, court dates, deadlines, and case progress all in one place</p>
                    <div class="feature-cta">Track My Cases ‚Üí</div>
                </div>

                <div class="feature-card" onclick="window.location.href='language_selection.html'" style="cursor: pointer;">
                    <div class="feature-icon">üåç</div>
                    <h3>Multi-Language Support</h3>
                    <p>Get legal assistance in Hindi, Marathi, Tamil, Telugu, Gujarati, Bengali, Kannada, Punjabi, and English</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìã</div>
                    <h3>Legal Forms</h3>
                    <p>Access and customize legal forms for rental agreements, employment contracts, and more</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üîí</div>
                    <h3>Secure & Private</h3>
                    <p>Your consultations are secure with rate limiting and privacy protection measures</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions" style="text-align: center; margin: 40px 0;">
                <h3 style="color: #f4f1e8; margin-bottom: 20px;">üöÄ Quick Actions</h3>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <a href="/templates.html" class="quick-action-btn">
                        üìÑ Create Documents
                    </a>
                    <a href="#" onclick="openCalculatorModal()" class="quick-action-btn">
                        üßÆ Calculate Rights
                    </a>
                    <a href="/legal-calculators.html" class="quick-action-btn">
                        üìä Advanced Calculators
                    </a>
                    <a href="/legal-help.html" class="quick-action-btn">
                        üèõÔ∏è Find Legal Help
                    </a>
                    <a href="#" onclick="openCaseTracker()" class="quick-action-btn">
                        üìã Track Cases
                    </a>
                    <a href="/language-selection.html" class="quick-action-btn">
                        üåç Choose Language
                    </a>
                    <a href="#" onclick="startConsultation()" class="quick-action-btn" id="chatBtn">
                        üí¨ Ask Legal Questions
                    </a>
                </div>
            </div>

            <!-- User Details Section -->
            <div class="name-section" id="personalizationBlock">
                <h2>Save your details (optional)</h2>
                <p>Personalize reminders and the Case Tracker by sharing your name and phone. You can also continue as a guest.</p>
                <div class="name-input-group">
                    <input type="text" id="userName" class="name-input" placeholder="Enter your full name" maxlength="50" style="margin-bottom: 10px;">
                    <input type="tel" id="userPhone" class="name-input" placeholder="Enter your phone number (10 digits)" maxlength="10" pattern="[0-9]{10}">
                    <button onclick="saveDetails()" class="save-name-btn">Save Details</button>
                </div>
                <div id="welcomeMessage" class="welcome-message" style="display: none;"></div>
            </div>

            <!-- CTA Section -->
            <div class="cta-section">
                <button id="startBtn" class="start-consulting-btn" onclick="startConsultation()" disabled>
                    üöÄ Start Consultation
                </button>
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Preparing your consultation session...</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>&copy; 2025 Saathi Legal Assistant. Built with ‚ù§Ô∏è for the legal community.</p>
            <p>Made in India üáÆüá≥ | Powered by AI <a href="/privacy.html" target="_blank" rel="noopener">Privacy Policy</a></p>
        </div>
    </div>

    <script>
        let userName = '';
        let userPhone = '';
        
        // Enable start button only after details are saved
        function saveDetails() {
            const nameInput = document.getElementById('userName');
            const phoneInput = document.getElementById('userPhone');
            const name = nameInput.value.trim();
            const phone = phoneInput.value.trim();
            
            // Clear any existing error messages
            clearErrorMessages();
            
            if (!name) {
                showError('Please enter your name to continue', nameInput);
                return;
            }
            
            if (name.length < 2) {
                showError('Please enter a valid name (at least 2 characters)', nameInput);
                return;
            }
            
            if (!/^[a-zA-Z\s\.]+$/.test(name)) {
                showError('Name should contain only letters, spaces, and dots', nameInput);
                return;
            }
            
            if (!phone) {
                showError('Please enter your phone number to continue', phoneInput);
                return;
            }
            
            if (!/^[6-9][0-9]{9}$/.test(phone)) {
                showError('Please enter a valid Indian mobile number (10 digits starting with 6-9)', phoneInput);
                return;
            }
            
            userName = name;
            userPhone = phone;
            
            // Save to localStorage for persistence
            localStorage.setItem('saathi_user_name', userName);
            localStorage.setItem('saathi_user_phone', userPhone);
            
            // Show success message
            showSuccess(`‚úÖ Welcome, ${userName}! Your details have been saved. You can now start your consultation.`);
            
            // Enable start button with smooth transition
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
            startBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            startBtn.style.transform = 'scale(1.02)';
            setTimeout(() => {
                startBtn.style.transform = 'scale(1)';
            }, 200);
            
            // Disable inputs with visual feedback
            nameInput.disabled = true;
            phoneInput.disabled = true;
            nameInput.style.background = 'rgba(139, 69, 19, 0.1)';
            phoneInput.style.background = 'rgba(139, 69, 19, 0.1)';
            
            const saveBtn = document.querySelector('.save-name-btn');
            saveBtn.disabled = true;
            saveBtn.style.background = '#28a745';
            saveBtn.innerHTML = '‚úì Details Saved';
        }

        // Error handling functions
        function showError(message, inputElement = null) {
            const errorDiv = document.getElementById('errorMessage') || createErrorDiv();
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            errorDiv.className = 'error-message show';
            
            if (inputElement) {
                inputElement.style.borderColor = '#dc3545';
                inputElement.focus();
                inputElement.addEventListener('input', clearFieldError, { once: true });
            }
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
                errorDiv.className = 'error-message';
            }, 4000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage') || createSuccessDiv();
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            successDiv.className = 'success-message show';
            
            setTimeout(() => {
                successDiv.style.display = 'none';
                successDiv.className = 'success-message';
            }, 3000);
        }

        function clearErrorMessages() {
            const errorDiv = document.getElementById('errorMessage');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
            
            // Reset input field styles
            document.getElementById('userName').style.borderColor = '';
            document.getElementById('userPhone').style.borderColor = '';
        }

        function clearFieldError(event) {
            event.target.style.borderColor = '';
        }

        function createErrorDiv() {
            const div = document.createElement('div');
            div.id = 'errorMessage';
            div.className = 'error-message';
            div.style.cssText = `
                background: #f8d7da; color: #721c24; border: 1px solid #f1aeb5;
                padding: 12px 20px; border-radius: 8px; margin: 15px 0;
                display: none; opacity: 0; transition: opacity 0.3s ease;
            `;
            document.querySelector('.name-section').appendChild(div);
            return div;
        }

        function createSuccessDiv() {
            const div = document.createElement('div');
            div.id = 'successMessage';
            div.className = 'success-message';
            div.style.cssText = `
                background: #d1e7dd; color: #0f5132; border: 1px solid #a3cfbb;
                padding: 12px 20px; border-radius: 8px; margin: 15px 0;
                display: none; opacity: 0; transition: opacity 0.3s ease;
            `;
            document.querySelector('.name-section').appendChild(div);
            return div;
        }
        
        // Check if details already saved
        function checkSavedDetails() {
            const savedName = localStorage.getItem('saathi_user_name');
            const savedPhone = localStorage.getItem('saathi_user_phone');
            if (savedName && savedPhone) {
                document.getElementById('userName').value = savedName;
                document.getElementById('userPhone').value = savedPhone;
                saveDetails();
            }
        }
        
        // Start consultation
        function startConsultation() {
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('startBtn').style.display = 'none';
            
            const basePayload = {
                user_name: userName || 'Guest',
                user_phone: userPhone || '',
                timestamp: new Date().toISOString(),
                session_id: generateSessionId()
            };
            const payloadWithAnon = window.saathiAnon && typeof window.saathiAnon.attachToPayload === 'function'
                ? window.saathiAnon.attachToPayload(basePayload)
                : {
                    ...basePayload,
                    anon_id: (window.localStorage && window.localStorage.getItem('saathi_anon_id')) || null
                };
            const headersWithAnon = window.saathiAnon && typeof window.saathiAnon.headers === 'function'
                ? window.saathiAnon.headers({ 'Content-Type': 'application/json' })
                : { 'Content-Type': 'application/json' };

            // Send user details to server for session tracking
            fetch('/api/start-session', {
                method: 'POST',
                headers: headersWithAnon,
                body: JSON.stringify(payloadWithAnon)
            }).then(response => {
                // Redirect to chat regardless of server response
                setTimeout(() => {
                    window.location.href = 'chat.html';
                }, 2000);
            }).catch(error => {
                // Still redirect even if session logging fails
                console.log('Session logging failed, but continuing...');
                setTimeout(() => {
                    window.location.href = 'chat.html';
                }, 2000);
            });
        }
        
        // Generate unique session ID
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function openCaseTracker() {
            if (!userName || !userPhone) {
                alert('Please save your name and phone to use the Case Tracker.');
                document.getElementById('personalizationBlock').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            window.location.href = 'case-tracker.html';
        }
        
        // Allow Enter key to save details
        document.getElementById('userName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('userPhone').focus();
            }
        });
        
        document.getElementById('userPhone').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                saveDetails();
            }
        });
        
        // Initialize
        checkSavedDetails();
        checkDeviceCompatibility();
        
        // Auto-focus on name input
        document.getElementById('userName').focus();
        
        function checkDeviceCompatibility() {
            const issues = [];
            const notice = document.getElementById('deviceNotice');
            
            // Check for common issues
            if (!navigator.onLine) {
                issues.push('No internet connection detected');
            }
            
            if (typeof fetch === 'undefined') {
                issues.push('Browser does not support fetch API');
            }
            
            if (typeof localStorage === 'undefined') {
                issues.push('Browser does not support local storage');
            }
            
            // Check if we can reach the server
            fetch('/health', { method: 'GET' })
                .then(response => {
                    if (!response.ok) {
                        issues.push('Cannot connect to server');
                        showDeviceNotice();
                    }
                })
                .catch(error => {
                    console.log('Server connectivity issue:', error);
                    showDeviceNotice();
                });
            
            // Show notice if there are issues or on certain devices
            const userAgent = navigator.userAgent.toLowerCase();
            if (issues.length > 0 || 
                userAgent.includes('samsung') || 
                userAgent.includes('ucbrowser') ||
                userAgent.includes('operamini')) {
                showDeviceNotice();
            }
        }
        
        function showDeviceNotice() {
            const notice = document.getElementById('deviceNotice');
            if (notice) {
                notice.style.display = 'block';
            }
        }
        
        // Calculator Modal Functions
        function openCalculatorModal() {
            document.getElementById('calculatorModal').style.display = 'block';
        }
        
        function closeCalculatorModal() {
            document.getElementById('calculatorModal').style.display = 'none';
        }
        
        function calculateGratuity() {
            const salaryInput = document.getElementById('salary');
            const yearsInput = document.getElementById('years');
            const monthsInput = document.getElementById('months');
            
            // Clear previous validation errors
            clearValidationErrors([salaryInput, yearsInput, monthsInput]);
            
            const salary = parseFloat(salaryInput.value);
            const years = parseInt(yearsInput.value);
            const months = parseInt(monthsInput.value) || 0;
            
            // Input validation
            const errors = [];
            
            if (!salary || salary <= 0) {
                errors.push({ field: salaryInput, message: 'Please enter a valid monthly salary' });
            } else if (salary > 10000000) {
                errors.push({ field: salaryInput, message: 'Salary seems too high. Please check the amount' });
            }
            
            if (!years || years < 0) {
                errors.push({ field: yearsInput, message: 'Please enter years of service (0 or more)' });
            } else if (years > 50) {
                errors.push({ field: yearsInput, message: 'Years of service seems too high. Please check' });
            }
            
            if (months < 0 || months > 11) {
                errors.push({ field: monthsInput, message: 'Extra months should be between 0-11' });
            }
            
            if (errors.length > 0) {
                showValidationErrors(errors);
                return;
            }
            
            // Show loading state
            const calculateBtn = event.target;
            const originalText = calculateBtn.innerHTML;
            calculateBtn.innerHTML = 'üîÑ Calculating...';
            calculateBtn.disabled = true;
            
            setTimeout(() => {
                // Gratuity eligibility check
                if (years < 5) {
                    showCalculatorResult('gratuityResult', 'Not Eligible ‚ùå', 
                        'Gratuity requires minimum 5 years of continuous service.<br><strong>Note:</strong> Death/disability exceptions may apply.', 
                        'warning');
                } else {
                    const totalYears = years + (months >= 6 ? 1 : 0);
                    const gratuity = Math.min((salary * 15 * totalYears) / 26, 2000000);
                    const formula = `(‚Çπ${salary.toLocaleString()} √ó 15 √ó ${totalYears}) √∑ 26`;
                    
                    showCalculatorResult('gratuityResult', `‚Çπ${gratuity.toLocaleString('en-IN')} ‚úÖ`, 
                        `<strong>Formula:</strong> ${formula}<br>
                         <strong>Years considered:</strong> ${totalYears} years<br>
                         <strong>Maximum limit:</strong> ‚Çπ20,00,000<br>
                         <strong>Tax:</strong> Exempt up to ‚Çπ20,00,000`, 
                        'success');
                }
                
                // Reset button
                calculateBtn.innerHTML = originalText;
                calculateBtn.disabled = false;
            }, 800);
        }
        
        function calculatePF() {
            const basicInput = document.getElementById('basicSalary');
            const yearsInput = document.getElementById('pfYears');
            const interestInput = document.getElementById('interest');
            
            // Clear previous validation errors
            clearValidationErrors([basicInput, yearsInput, interestInput]);
            
            const basic = parseFloat(basicInput.value);
            const years = parseFloat(yearsInput.value);
            const rate = parseFloat(interestInput.value) / 100;
            
            // Input validation
            const errors = [];
            
            if (!basic || basic <= 0) {
                errors.push({ field: basicInput, message: 'Please enter a valid basic salary' });
            } else if (basic > 5000000) {
                errors.push({ field: basicInput, message: 'Basic salary seems too high. Please check the amount' });
            }
            
            if (!years || years < 0) {
                errors.push({ field: yearsInput, message: 'Please enter years of service (0 or more)' });
            } else if (years > 50) {
                errors.push({ field: yearsInput, message: 'Years of service seems too high. Please check' });
            }
            
            if (!rate || rate < 0 || rate > 0.20) {
                errors.push({ field: interestInput, message: 'Interest rate should be between 0% and 20%' });
            }
            
            if (errors.length > 0) {
                showValidationErrors(errors);
                return;
            }
            
            // Show loading state
            const calculateBtn = event.target;
            const originalText = calculateBtn.innerHTML;
            calculateBtn.innerHTML = 'üîÑ Calculating...';
            calculateBtn.disabled = true;
            
            setTimeout(() => {
                const monthlyContribution = Math.min(basic * 0.24, 21600); // PF cap
                const annualContribution = monthlyContribution * 12;
                const balance = years > 0 ? annualContribution * (Math.pow(1 + rate, years) - 1) / rate : 0;
                
                showCalculatorResult('pfResult', `‚Çπ${balance.toLocaleString('en-IN')} ‚úÖ`, 
                    `<strong>Monthly contribution:</strong> ‚Çπ${monthlyContribution.toLocaleString('en-IN')}<br>
                     <strong>Annual contribution:</strong> ‚Çπ${annualContribution.toLocaleString('en-IN')}<br>
                     <strong>Interest rate:</strong> ${(rate*100).toFixed(1)}%<br>
                     <strong>Withdrawal rules:</strong> Partial withdrawal after 5 years`, 
                    'success');
                
                // Reset button
                calculateBtn.innerHTML = originalText;
                calculateBtn.disabled = false;
            }, 800);
        }
        
        function calculateStampDuty() {
            const valueInput = document.getElementById('propertyValue');
            const stateSelect = document.getElementById('state');
            
            // Clear previous validation errors
            clearValidationErrors([valueInput]);
            
            const value = parseFloat(valueInput.value);
            const rate = parseFloat(stateSelect.value);
            
            // Input validation
            const errors = [];
            
            if (!value || value <= 0) {
                errors.push({ field: valueInput, message: 'Please enter a valid property value' });
            } else if (value < 100000) {
                errors.push({ field: valueInput, message: 'Property value seems too low. Please check the amount' });
            } else if (value > 1000000000) {
                errors.push({ field: valueInput, message: 'Property value seems too high. Please check the amount' });
            }
            
            if (errors.length > 0) {
                showValidationErrors(errors);
                return;
            }
            
            // Show loading state
            const calculateBtn = event.target;
            const originalText = calculateBtn.innerHTML;
            calculateBtn.innerHTML = 'üîÑ Calculating...';
            calculateBtn.disabled = true;
            
            setTimeout(() => {
                const stampDuty = value * rate;
                const registrationFee = Math.min(value * 0.01, 30000); // 1% capped at ‚Çπ30,000
                const total = stampDuty + registrationFee;
                
                showCalculatorResult('stampResult', `‚Çπ${stampDuty.toLocaleString('en-IN')} ‚úÖ`, 
                    `<strong>Stamp Duty:</strong> ‚Çπ${stampDuty.toLocaleString('en-IN')}<br>
                     <strong>Registration Fee:</strong> ‚Çπ${registrationFee.toLocaleString('en-IN')}<br>
                     <strong>Total Cost:</strong> ‚Çπ${total.toLocaleString('en-IN')}<br>
                     <strong>Rate Applied:</strong> ${(rate*100).toFixed(1)}%`, 
                    'success');
                
                // Reset button
                calculateBtn.innerHTML = originalText;
                calculateBtn.disabled = false;
            }, 800);
        }
        
        // Helper functions for validation and results
        function clearValidationErrors(inputs) {
            inputs.forEach(input => {
                input.style.borderColor = 'rgba(139, 69, 19, 0.3)';
                input.style.backgroundColor = 'rgba(244, 241, 232, 0.15)';
                
                // Remove existing error messages
                const existingError = input.parentNode.querySelector('.validation-error');
                if (existingError) {
                    existingError.remove();
                }
            });
        }
        
        function showValidationErrors(errors) {
            errors.forEach(error => {
                // Style the field
                error.field.style.borderColor = '#dc3545';
                error.field.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                
                // Add error message
                const errorDiv = document.createElement('div');
                errorDiv.className = 'validation-error';
                errorDiv.style.cssText = 'color: #dc3545; font-size: 0.9em; margin-top: 5px; font-weight: bold;';
                errorDiv.textContent = error.message;
                
                error.field.parentNode.insertBefore(errorDiv, error.field.nextSibling);
            });
        }
        
        function showCalculatorResult(elementId, amount, details, type = 'success') {
            const element = document.getElementById(elementId);
            const bgColor = type === 'success' ? 'rgba(40, 167, 69, 0.1)' : 'rgba(255, 193, 7, 0.1)';
            const borderColor = type === 'success' ? 'rgba(40, 167, 69, 0.3)' : 'rgba(255, 193, 7, 0.3)';
            
            element.style.background = bgColor;
            element.style.border = `1px solid ${borderColor}`;
            element.innerHTML = `
                <div style="text-align: center;">
                    <h4 style="color: #f4f1e8; margin: 0 0 15px 0; font-size: 1.5em;">${amount}</h4>
                    <div style="color: #d4c4a8; line-height: 1.6;">${details}</div>
                </div>
            `;
            element.style.display = 'block';
            
            // Scroll to result
            element.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function showResult(elementId, amount, details) {
            showCalculatorResult(elementId, amount, details, 'success');
        }

        // Language functionality
        function loadLanguagePreference() {
            const savedLanguage = localStorage.getItem('preferredLanguage');
            const languageName = localStorage.getItem('languageName');
            
            if (savedLanguage && languageName) {
                document.getElementById('currentLanguage').textContent = languageName;
                
                // Add a small notification that language is active
                const indicator = document.getElementById('languageIndicator');
                indicator.style.background = 'rgba(40, 167, 69, 0.2)';
                indicator.style.borderColor = 'rgba(40, 167, 69, 0.3)';
                indicator.title = `Current language: ${languageName}. Click to change.`;
            } else {
                // Suggest selecting a language
                document.getElementById('languageIndicator').title = 'Click to select your preferred language';
            }
        }

        // Load language preference when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadLanguagePreference();
        });
    </script>

    <!-- Rights Calculator Modal -->
    <div id="calculatorModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);">
        <div style="background: linear-gradient(135deg, #1a2332 0%, #2a3441 100%); margin: 5% auto; padding: 30px; border: 2px solid #8b4513; border-radius: 15px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 style="color: #f4f1e8; margin: 0;">üßÆ Legal Rights Calculator</h2>
                <button onclick="closeCalculatorModal()" style="background: none; border: none; color: #f4f1e8; font-size: 2em; cursor: pointer;">&times;</button>
            </div>
            
            <!-- Gratuity Calculator -->
            <div style="background: rgba(244, 241, 232, 0.1); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h3 style="color: #f4f1e8; margin-bottom: 20px;">üí∞ Gratuity Calculator</h3>
                <div style="display: grid; gap: 15px;">
                    <input type="number" id="salary" placeholder="Monthly Salary (‚Çπ)" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <input type="number" id="years" placeholder="Years of Service" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <input type="number" id="months" placeholder="Extra Months (0-11)" min="0" max="11" value="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <button onclick="calculateGratuity()" style="background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); color: #f4f1e8; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; cursor: pointer;">Calculate Gratuity</button>
                </div>
                <div id="gratuityResult" style="background: rgba(244, 241, 232, 0.1); border-radius: 10px; padding: 20px; margin: 20px 0; display: none;"></div>
            </div>

            <!-- PF Calculator -->
            <div style="background: rgba(244, 241, 232, 0.1); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h3 style="color: #f4f1e8; margin-bottom: 20px;">üè¶ Provident Fund Calculator</h3>
                <div style="display: grid; gap: 15px;">
                    <input type="number" id="basicSalary" placeholder="Basic Salary (‚Çπ)" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <input type="number" id="pfYears" placeholder="Years of Service" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <input type="number" id="interest" placeholder="Interest Rate %" value="8.5" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <button onclick="calculatePF()" style="background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); color: #f4f1e8; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; cursor: pointer;">Calculate PF Balance</button>
                </div>
                <div id="pfResult" style="background: rgba(244, 241, 232, 0.1); border-radius: 10px; padding: 20px; margin: 20px 0; display: none;"></div>
            </div>

            <!-- Stamp Duty Calculator -->
            <div style="background: rgba(244, 241, 232, 0.1); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h3 style="color: #f4f1e8; margin-bottom: 20px;">üè† Stamp Duty Calculator</h3>
                <div style="display: grid; gap: 15px;">
                    <input type="number" id="propertyValue" placeholder="Property Value (‚Çπ)" min="0" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                    <select id="state" style="width: 100%; padding: 12px; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; background: rgba(244, 241, 232, 0.15); color: #f4f1e8;">
                        <option value="0.05">Maharashtra (5%)</option>
                        <option value="0.06">Delhi (6%)</option>
                        <option value="0.05">Karnataka (5%)</option>
                        <option value="0.04">Gujarat (4%)</option>
                        <option value="0.05">Other States (5%)</option>
                    </select>
                    <button onclick="calculateStampDuty()" style="background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); color: #f4f1e8; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; cursor: pointer;">Calculate Stamp Duty</button>
                </div>
                <div id="stampResult" style="background: rgba(244, 241, 232, 0.1); border-radius: 10px; padding: 20px; margin: 20px 0; display: none;"></div>
            </div>

            <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; padding: 15px; margin: 20px 0; color: #f4f1e8; text-align: center;">
                <strong>‚ö†Ô∏è Disclaimer:</strong> These are estimates based on general legal provisions. Consult a legal expert for accurate advice.
            </div>
        </div>
    </div>
    </script>
    <script src="enhanced-ux.js"></script>
</body>
</html>
